# 微信小程序


## 微信小程序开发和普通网页开发有什么区别
*小程序主要开发语言是javascript, 小程序的开发痛普通网页的开发具有很大的相似性*
1. <font color=red>运行环境: </font> 
    * 微信小程序运行在微信环境中，这意味着微信小程序具有更高的集成度和便利性，但是同时也限制了其功能和访问权限，渲染层和逻辑层是分开的
    * 普通网页运行在浏览器环境中，网页开发的渲染线程和js简本线程时互斥的
2. <font color=red>开发语言: </font> 
    * 微信小程序主要使用的是 WXML、WXSS、WXS，这是基于 XML 和 CSS 的语言
    * 普通网页开发主要使用 HTML、CSS
3. <font color=red>API 差异: </font>
    * 微信小程序提供了很多特定的API，如微信登陆，微信支付，地理位置等api
    * 普通网页开发可以使用更广泛的 Web API
4. <font color=red>更新机制: </font>
    * 微信小程序发布时，需要经过后台审核通过才能更新，者使得更新和维护变得相对复杂
    * 普通网页开发可以随时进行发布
5. <font color=red>性能优化: </font>
    * 微信小程序需要考虑更多的性能优化问题，如代码拆分、按需加载、懒加载
    * 普通网页开发这些可能都不是需要备首要考虑的问题
6. <font color=red>安全性: </font>
    * 由于小程序具有更改的集成度和访问权限，因此安全性问题更加重要，开发者需要更加关注数据安全和用户隐私保护
7. <font color=red>跨平台开发: </font>
    * 小程序可以在多个平台上运行，如微信、支付宝等。
    * 普通网页开发则需要针对不同的浏览器和平台进行适配和优化

<font color=green>微信小程序运行环境:</font>
|运行环境|逻辑层|渲染层|
|--|--|--|
|IOS|JavascriptCore|WKWebView|
|安卓|V8|chromium 定制内核|
|小程序开发者工具|NWJS|Chrome WebView|


## 小程序框架系统
*微信小程序框架系统分为 **<font color=green>逻辑层</font>** 和 **<font color=green>渲染层</font>*** 

#### 小程序通信模型
![小程序架构图](image.png)
1. 小程序的 渲染层和逻辑层分别有两个线程管理
    * 渲染层的界面使用了 WebView 进行渲染
    * 逻辑层使用 JSCore 线程运行js脚本
2. 两个线程之间的通信主要通过 <font color=red>微信客户端(Native)</font> 进行通信
3. Native 客户端提供了 数据传输的事件系统
4. 小程序框架核心是 `响应的事件绑定系统`。在逻辑层修改数据的时候，通过Native通信 ，视图层也会做出响应的变化

#### 逻辑层
*开发者写的所有代码都会打包成一份js文件，并且在小程序启动的时候运行，直到小程序销毁。这一系列的行为类似于ServiceWorker, 所以逻辑层也被称为App Service*
1. 在JS 的基础上，新增了一些功能，以便于小程序的开发
    * 增加了 <font color=red>App</font> 方法和 <font color=red>Page</font> 方法，进行`程序注册`和`页面注册`
    * 增加了 <font color=red>getApp</font> 方法 和 <font color=red>getCurrentPages</font> 方法，分别用来获取 APP 实例和当前页面栈
    * 提供丰富的 API，如微信用户数据，扫一扫、支付等微信特有的能力
    * 提供模块化的能力，每个页面都有独立的作用域

#### 视图层
1. WXML(WeiXin Markup language): 描述页面结构
2. WXS(WeiXin Script): 小程序的一套脚本语言，结合 WXML ，可以构建出页面的结构
    * wxs 是内联在WXML 中的脚本段（页面渲染），通过 WXS 可以在模版中内联少量处理脚本，丰富模板的预处理能力
    * 还能用来编写简单的 WXS 事件响应函数（数据处理）
    * 使用 wsx 可以减少事件通信次数
3. WXSS(WeiXin Style Sheet): 描述页面样式

#### 事件系统（通信）
* 事件是视图层和逻辑层的通讯方式
* 事件可以将用户的行为反馈到逻辑层处理
* 事件可以绑定到组件上，当触发事件时，就会执行逻辑层中对应事件的处理函数
* 事件对象可以携带额外信息，如 id、dataset、touches
*** 
1. 事件分类
    * 冒泡事件
    * 非冒泡事件
